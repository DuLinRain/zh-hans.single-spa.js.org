(window.webpackJsonp=window.webpackJsonp||[]).push([[112],{239:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return i})),a.d(t,"rightToc",(function(){return s})),a.d(t,"default",(function(){return p}));var n=a(1),o=a(9),r=(a(0),a(308)),i={id:"recommended-setup",title:"\u63a8\u8350\u8bbe\u7f6e",sidebar_label:"\u6982\u8ff0"},s=[{value:"\u6982\u8ff0",id:"\u6982\u8ff0",children:[]},{value:"\u5176\u4ed6\u9009\u62e9",id:"\u5176\u4ed6\u9009\u62e9",children:[]},{value:"\u8fd0\u884c\u65f6\u6a21\u5757 vs. \u6784\u5efa\u65f6\u6a21\u5757",id:"\u8fd0\u884c\u65f6\u6a21\u5757-vs-\u6784\u5efa\u65f6\u6a21\u5757",children:[]},{value:"Import Maps",id:"import-maps",children:[]},{value:"Module Federation",id:"module-federation",children:[]},{value:"SystemJS",id:"systemjs",children:[]},{value:"\u61d2\u52a0\u8f7d",id:"\u61d2\u52a0\u8f7d",children:[]},{value:"\u672c\u5730\u5f00\u53d1",id:"\u672c\u5730\u5f00\u53d1",children:[]},{value:"\u6784\u5efa\u5de5\u5177 (Webpack / Rollup)",id:"\u6784\u5efa\u5de5\u5177-webpack--rollup",children:[]},{value:"Utility modules (styleguide, API, etc)",id:"utility-modules-styleguide-api-etc",children:[]},{value:"Shared dependencies",id:"shared-dependencies",children:[{value:"Comparison of approaches",id:"comparison-of-approaches",children:[]},{value:"Sharing with Import Maps",id:"sharing-with-import-maps",children:[]},{value:"Sharing with Module Federation",id:"sharing-with-module-federation",children:[]}]},{value:"Deployment and Continuous Integration (CI)",id:"deployment-and-continuous-integration-ci",children:[]},{value:"Applications versus parcels versus utility modules",id:"applications-versus-parcels-versus-utility-modules",children:[]},{value:"Inter-app communication",id:"inter-app-communication",children:[{value:"Functions, components, logic, and environment variables",id:"functions-components-logic-and-environment-variables",children:[]},{value:"API Data",id:"api-data",children:[]},{value:"UI State",id:"ui-state",children:[]}]},{value:"State management",id:"state-management",children:[]}],c={rightToc:s},l="wrapper";function p(e){var t=e.components,a=Object(o.a)(e,["components"]);return Object(r.b)(l,Object(n.a)({},c,a,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"Single-spa NPM\u5305\u5e76\u4e0d\u662f\u9488\u5bf9\u6784\u5efa\u5de5\u5177\uff0cCI\u6d41\u6c34\u7ebf\uff0c\u6216\u8005\u5f00\u53d1\u73af\u5883\u5de5\u4f5c\u5de5\u4f5c\u6d41\u7684\u67d0\u4e00\u4e2a\u8fc7\u7a0b\u3002\u800c\u4e3a\u4e86\u5b9e\u73b0single-spa\u4f60\u9700\u8981\u8bbe\u7f6e\u8fd9\u4e9b\u914d\u7f6e\uff08\u53ef\u80fd\u66f4\u591a\uff09\u3002\u4e3a\u4e86\u5e2e\u52a9\u60a8\u641e\u660e\u767d\u5982\u4f55\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\uff0csingle-spa\u6838\u5fc3\u56e2\u961f\u63a8\u51fa\u4e86\u201c\u63a8\u8350\u914d\u7f6e\u201d\uff0c\u5e0c\u671b\u5b83\u80fd\u89e3\u51b3\u76f4\u63a5\u89e3\u51b3\u60a8\u5b9e\u73b0\u5fae\u524d\u7aef\u8fc7\u7a0b\u4e2d\u7684\u67d0\u4e9b\u95ee\u9898\u3002"),Object(r.b)("h2",{id:"\u6982\u8ff0"},"\u6982\u8ff0"),Object(r.b)("p",null,"\u6211\u4eec\u5efa\u8bae\u4f7f\u7528\u6d4f\u89c8\u5668\u5185ES\u6a21\u5757 + import maps (\u6216\u8005SystemJS\u586b\u5145\u8fd9\u4e9b\uff0c\u5982\u679c\u4f60\u9700\u8981\u66f4\u597d\u7684\u6d4f\u89c8\u5668\u652f\u6301)\u7684\u8bbe\u7f6e\u3002\u8fd9\u79cd\u8bbe\u7f6e\u6709\u51e0\u4e2a\u4f18\u70b9:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"\u516c\u5171\u6a21\u5757\u6613\u4e8e\u7ba1\u7406\uff0c\u5e76\u4e14\u53ea\u4e0b\u8f7d\u4e00\u6b21\u3002\u5982\u679c\u4f7f\u7528SystemJS\uff0c\u4e5f\u53ef\u4ee5\u9884\u52a0\u8f7d\u5b83\u4eec\u6765\u63d0\u9ad8\u901f\u5ea6\u3002"),Object(r.b)("li",{parentName:"ol"},"\u5171\u4eab\u4ee3\u7801/\u51fd\u6570/\u53d8\u91cf\u5c31\u50cf\u5bfc\u5165/\u5bfc\u51fa\u4e00\u6837\u7b80\u5355\uff0c\u5c31\u50cf\u5728\u4e00\u4e2a\u6574\u4f53\u4e2d\u8bbe\u7f6e\u4e00\u6837\u3002"),Object(r.b)("li",{parentName:"ol"},"\u5ef6\u8fdf\u52a0\u8f7d\u5e94\u7528\u7a0b\u5e8f\u5f88\u5bb9\u6613\uff0c\u8fd9\u4f7f\u60a8\u80fd\u591f\u52a0\u901f\u521d\u59cb\u52a0\u8f7d\u65f6\u95f4\u3002"),Object(r.b)("li",{parentName:"ol"},"\u6bcf\u4e2a\u5e94\u7528\u7a0b\u5e8f(\u53c8\u540d\u5fae\u670d\u52a1\uff0c\u53c8\u540dES\u6a21\u5757)\u90fd\u53ef\u4ee5\u72ec\u7acb\u5f00\u53d1\u548c\u90e8\u7f72\u3002\u56e2\u961f\u53ef\u4ee5\u6309\u7167\u81ea\u5df1\u7684\u8fdb\u5ea6\u5de5\u4f5c\u3001\u5b9e\u9a8c(\u5728\u7ec4\u7ec7\u5b9a\u4e49\u7684\u5408\u7406\u8303\u56f4\u5185)\u3001QA\u548c\u90e8\u7f72\u3002\u8fd9\u901a\u5e38\u4e5f\u610f\u5473\u7740\u53d1\u5e03\u5468\u671f\u53ef\u4ee5\u7f29\u77ed\u5230\u51e0\u5929\uff0c\u800c\u4e0d\u662f\u51e0\u5468\u6216\u51e0\u4e2a\u6708\u3002"),Object(r.b)("li",{parentName:"ol"},"\u5f88\u68d2\u7684\u5f00\u53d1\u4eba\u5458\u4f53\u9a8c(DX):\u8f6c\u5230dev\u73af\u5883\u5e76\u6dfb\u52a0\u4e00\u4e2a\u5bfc\u5165\u6620\u5c04\uff0c\u8be5\u6620\u5c04\u5c06\u5e94\u7528\u7a0b\u5e8f\u7684url\u6307\u5411\u60a8\u7684\u672c\u5730\u4e3b\u673a\u3002\u8bf7\u53c2\u9605\u4e0b\u9762\u7684\u7ae0\u8282\u4e86\u89e3\u8be6\u7ec6\u4fe1\u606f\u3002")),Object(r.b)("h2",{id:"\u5176\u4ed6\u9009\u62e9"},"\u5176\u4ed6\u9009\u62e9"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/umijs/qiankun"}),"qiankun")," \u662f\u4e00\u4e2a\u5f88\u4e0d\u9519\u7684\u66ff\u4ee3\u54c1\u3002"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/namecheap/ilc"}),"Isomorphic Layout Composer")," - \u4e00\u4e2a\u5c06\u5fae\u524d\u7aef\u7ec4\u6210\u90e8\u5206\u652f\u6301SSR\u5b8c\u6574\u7684\u89e3\u51b3\u65b9\u6848\u3002")),Object(r.b)("h2",{id:"\u8fd0\u884c\u65f6\u6a21\u5757-vs-\u6784\u5efa\u65f6\u6a21\u5757"},"\u8fd0\u884c\u65f6\u6a21\u5757 vs. \u6784\u5efa\u65f6\u6a21\u5757"),Object(r.b)("p",null,"\u6559\u7a0b\u89c6\u9891: ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.youtube.com/watch?v=Jxqiu6pdMSU&list=PLLUD8RtHvsAOhtHnyGx57EYXoaNsxGrTU&index=2"}),"Youtube")," / ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.bilibili.com/video/av83498486/"}),"Bilibili")),Object(r.b)("p",null,"\u8fd0\u884c\u65f6\u6a21\u5757\uff0c\u5f53\u88ab\u5f15\u7528\u548c\u5bfc\u51fa\u65f6\u4e0d\u4f1a\u88ab\u6784\u5efa\u5de5\u5177\u7f16\u8bd1\uff0c\u5b83\u76f4\u63a5\u88ab\u6d4f\u89c8\u5668\u89e3\u6790\u3002\u5b83\u662f\u4e0e\u6784\u5efa\u65f6\u6a21\u5757\u7684\u4e0d\u540c\u4e4b\u5904\uff0c\u4ed6\u4eec\u5728\u88ab\u6d4f\u89c8\u5668\u89e3\u6790\u524d\u9700\u8981\u7531node_modules\u63d0\u4f9b\u5e76\u7f16\u8bd1\u3002"),Object(r.b)("p",null,"\u544a\u8bc9webpack\u548crollup\u5728\u6784\u5efa\u671f\u95f4\u4fdd\u7559\u4e00\u4e9b\u4f9d\u8d56\u9879\uff0c\u4ee5\u4fbf\u5b83\u4eec\u6765\u81ea\u6d4f\u89c8\u5668\u7684\u65b9\u6cd5\u662f\u901a\u8fc7",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://webpack.js.org/configuration/externals/#root"}),"webpack externals"),"\u548c",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://rollupjs.org/guide/en/#external"}),"rollup externals"),"\u3002"),Object(r.b)("p",null,"\u4ee5\u4e0b\u662f\u6211\u4eec\u7684\u63a8\u8350:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"\u6bcf\u4e2asingle-spa\u5e94\u7528\u7a0b\u5e8f\u90fd\u5e94\u8be5\u662f\u4e00\u4e2a\u6d4f\u89c8\u5668\u5185\u7684Javascript\u6a21\u5757"),Object(r.b)("li",{parentName:"ol"},"\u5927\u578b\u5171\u4eab\u4f9d\u8d56(\u6bd4\u5982react\u3001vue\u6216angular\u5e93)\u5e94\u8be5\u90fd\u662f\u6d4f\u89c8\u5668\u5185\u7684\u6a21\u5757\u3002"),Object(r.b)("li",{parentName:"ol"},"\u5176\u4ed6\u7684\u90fd\u5e94\u8be5\u662f\u6784\u5efa\u65f6\u6a21\u5757\u3002")),Object(r.b)("h2",{id:"import-maps"},"Import Maps"),Object(r.b)("p",null,"\u6559\u7a0b\u89c6\u9891: ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.youtube.com/watch?v=Lfm2Ge_RUxs&list=PLLUD8RtHvsAOhtHnyGx57EYXoaNsxGrTU&index=3"}),"Youtube")," / ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.bilibili.com/video/av83617496/"}),"Bilibili")),Object(r.b)("p",null,Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/WICG/import-maps"}),"Import Maps"),"\u662f\u4e00\u4e2a\u6d4f\u89c8\u5668\u89c4\u8303\uff0c\u7528\u4e8e\u5c06\u67d0\u4e2aURL\u8d77\u4e00\u4e2a\u201cImport specifier\u201d\u7684\u522b\u540d\u3002\nimport specifier\u662f\u6307\u793a\u8981\u52a0\u8f7d\u54ea\u4e2a\u6a21\u5757\u7684\u5b57\u7b26\u4e32\u3002\u4f8b\u5b50:"),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-js"}),"// ./thing.js is the import specifier\nimport thing from './thing.js';\n\n// react is the import specifier\nimport React from 'react';\n")),Object(r.b)("p",null,"\u4e0d\u662fURL\u7684\u8bf4\u660e\u7b26\u79f0\u4e3a\u201c\u7eaf\u8bf4\u660e\u7b26\u201d\uff0c\u5982\u201cimport\u201dreact\u201d\u3002\u5bf9\u4e8e\u80fd\u591f\u4f7f\u7528\u6d4f\u89c8\u5668\u5185\u6a21\u5757\u6765\u8bf4\uff0c\u80fd\u591f\u5c06\u88f8\u8bf4\u660e\u7b26\u522b\u540d\u4e3aURL\u662f\u81f3\u5173\u91cd\u8981\u7684\uff0c\u8fd9\u5c31\u662f\u5b58\u5728\u5bfc\u5165\u6620\u5c04\u7684\u539f\u56e0\u3002"),Object(r.b)("p",null,"\u622a\u6b62\u52302020\u5e742\u6708\uff0cimport maps\u4ec5\u5728Chrome\u4e2d\u5b9e\u73b0\uff0c\u5e76\u5728\u5f00\u53d1\u8005\u7279\u6027\u5207\u6362\u540e\u5b9e\u73b0\u3002\u56e0\u6b64\uff0c\u60a8\u5c06\u9700\u8981\u4e00\u4e2apolyfill\u4f7fimport maps\u6b63\u5e38\u5de5\u4f5c\u3002"),Object(r.b)("h2",{id:"module-federation"},"Module Federation"),Object(r.b)("p",null,Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://dev.to/marais/webpack-5-%E5%92%8Cmodule-feder-4j1i"}),"\u6a21\u5757\u8054\u5408"),"\u662f\u4e00\u79cdwebpack-specific\u6280\u672f\uff0c\u7528\u4e8e\u5171\u4eab","[\u6784\u5efa\u65f6\u6a21\u5757]","(#in-browser- vs -build-time-modules)\u3002\u5b83\u6d89\u53ca\u5230\u6bcf\u4e2amicrofrontend\u6346\u7ed1\u5b83\u6240\u6709\u7684\u4f9d\u8d56\uff0c\u751a\u81f3\u5171\u4eab\u7684\u4f9d\u8d56\u3002\u8fd9\u610f\u5473\u7740\u6bcf\u4e2a\u5171\u4eab\u4f9d\u8d56\u9879\u90fd\u6709\u591a\u4e2a\u526f\u672c\u2014\u2014\u6bcf\u4e2amicrofrontend\u4e00\u4e2a\u3002\u5728\u6d4f\u89c8\u5668\u4e2d\uff0c\u5171\u4eab\u4f9d\u8d56\u9879\u7684\u7b2c\u4e00\u4e2a\u526f\u672c\u5c06\u88ab\u4e0b\u8f7d\uff0c\u4f46\u968f\u540e\u7684microfrontend\u5c06\u91cd\u7528\u8be5\u5171\u4eab\u4f9d\u8d56\u9879\uff0c\u800c\u4e0d\u9700\u8981\u4e0b\u8f7d\u5b83\u4eec\u7684\u526f\u672c\u3002"),Object(r.b)("p",null,"\u6ce8\u610f\uff0c\u6a21\u5757\u8054\u5408\u662f\u4e00\u4e2a\u65b0\u7279\u6027(\u5728\u64b0\u5199\u672c\u6587\u65f6)\uff0c\u5b83\u8981\u6c42\u60a8\u4f7f\u7528webpack@>=5(\u76ee\u524d\u5728beta\u7248)\u3002\u5b83\u4ecd\u7136\u662f\u4e00\u9879\u4e0d\u65ad\u53d1\u5c55\u7684\u6280\u672f\u3002"),Object(r.b)("p",null,"single-spa \u662f\u4e00\u79cd\u7ec4\u7ec7\u5fae\u524d\u7aef\u8def\u7531\u7684\u65b9\u6848\u3002\u6a21\u5757\u8054\u5408\u662fmicrofrontend\u7684\u4e00\u79cd\u6027\u80fd\u6280\u672f\u3002\u5b83\u4eec\u76f8\u4e92\u8865\u5145\u5f88\u597d\uff0c\u53ef\u4ee5\u4e00\u8d77\u4f7f\u7528\u3002 \u4e0b\u9762\u662f\u4e00\u4e2a\u793e\u533a\u6210\u5458\u53d1\u5e03\u7684",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.youtube.com/watch?v=wxnwPLLIJCY"}),"YouTube\u89c6\u9891"),"\uff0c\u8ba8\u8bba\u4e86\u5982\u4f55\u540c\u65f6\u4f7f\u7528single-spa\u548c\u6a21\u5757\u8054\u5408\u3002"),Object(r.b)("p",null,"\u4f7f\u7528\u6a21\u5757\u8054\u5408\uff0c\u60a8\u5fc5\u987b\u9009\u62e9\u5982\u4f55\u52a0\u8f7dmicrofrontend\u672c\u8eab\u3002single-spa\u6838\u5fc3\u56e2\u961f\u5efa\u8bae\u4f7f\u7528SystemJS + import map\u4f5c\u4e3a\u5fae\u524d\u7aef\u7684\u6a21\u5757\u52a0\u8f7d\u5668\u3002 \u4f5c\u4e3a\u66ff\u4ee3, \u4f60\u53ef\u4ee5\u4f7f\u7528\u5168\u5c40\u53d8\u91cf\u548c ",Object(r.b)("inlineCode",{parentName:"p"},"<script>")," \u6807\u7b7e\u3002 \u4e00\u4e2a\u4f7f\u7528SystemJS\u548c\u6a21\u5757\u8054\u5408\u52a0\u8f7d\u5fae\u524d\u7aef\u7684\u4f8b\u5b50\u5728 ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/ScriptedAlchemy/mfe-webpack-demo/pull/2"}),"https://github.com/ScriptedAlchemy/mfe-webpack-demo/pull/2"),"."),Object(r.b)("p",null,"The single-spa core team recommends choosing either import maps or module federation for your shared, third-party dependencies. We do not recommend sharing some third-party dependencies via import map and others via module federation. When choosing between the two approaches, we have a preference towards import maps, but no objection to module federation. See the ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"#shared-dependencies"}),"shared dependencies section")," for a comparison."),Object(r.b)("p",null,"single-spa\u6838\u5fc3\u56e2\u961f\u5efa\u8bae\u4e3a\u5171\u4eab\u7684\u7b2c\u4e09\u65b9\u4f9d\u8d56\u9879\u9009\u62e9import maps\u6216\u6a21\u5757\u8054\u5408\u3002\u6211\u4eec\u4e0d\u5efa\u8bae\u901a\u8fc7import map\u5171\u4eab\u4e00\u4e9b\u7b2c\u4e09\u65b9\u4f9d\u8d56\u9879\uff0c\u53e6\u4e00\u4e9b\u901a\u8fc7\u6a21\u5757\u8054\u5408\u5171\u4eab\u5176\u4ed6\u4f9d\u8d56\u9879\u3002\u5728\u9009\u62e9\u8fd9\u4e24\u79cd\u65b9\u6cd5\u65f6\uff0c\u6211\u4eec\u503e\u5411\u4e8eimport maps\uff0c\u4f46\u4e0d\u53cd\u5bf9\u6a21\u5757\u8054\u5408\u3002\u8bf7\u53c2\u9605",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"#shared-dependencies"}),"\u5171\u4eab\u4f9d\u8d56\u9879\u90e8\u5206"),"\u8fdb\u884c\u6bd4\u8f83\u3002"),Object(r.b)("h2",{id:"systemjs"},"SystemJS"),Object(r.b)("p",null,"\u6559\u7a0b\u89c6\u9891: ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.youtube.com/watch?v=AmdKF2UhFzw&list=PLLUD8RtHvsAOhtHnyGx57EYXoaNsxGrTU&index=7"}),"Youtube")," / ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.bilibili.com/video/av83620028/"}),"Bilibili")),Object(r.b)("p",null,"SystemJS\u4e3aimport maps\u548c\u8fd0\u884c\u65f6\u6a21\u5757\u63d0\u4f9b\u4e86\u50cfpolyfill\u4e00\u6837\u884c\u4e3a\u3002\u5b83\u4e0d\u662f\u5bfc\u5165\u6620\u5c04\u7684\u771f\u6b63polyfill\uff0c\u8fd9\u662f\u7531\u4e8eJavaScript\u8bed\u8a00\u5728polyfill\u5bfc\u5165\u8bf4\u660e\u7b26\u5230url\u7684\u89e3\u6790\u65b9\u9762\u7684\u9650\u5236\u3002"),Object(r.b)("p",null,"\u56e0\u4e3aSystemJS\u53ea\u662f\u50cfpolyfill\uff0c\u4f60\u9700\u8981\u6309\u7167",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/systemjs/systemjs/blob/master/docs/system-register.md"}),"System.register format"),"\u7f16\u8bd1\u4f60\u7684\u5e94\u7528\uff0c\u800c\u4e0d\u662fESM format\u3002\u8fd9\u5141\u8bb8\u5728\u4e0d\u652f\u6301\u6a21\u5757\u6216importmaps\u7684\u73af\u5883\u4e2d\u5b8c\u5168\u6a21\u62df\u6d4f\u89c8\u5668\u5185\u7684\u6a21\u5757\u3002"),Object(r.b)("p",null,"\u4e3a\u4e86\u628a\u4f60\u7684\u4ee3\u7801\u7f16\u8bd1\u6210System.register format\uff0c\u9700\u8981\u8bbe\u7f6ewebpack\u7684",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://webpack.js.org/configuration/output/#outputlibrarytarget"}),Object(r.b)("inlineCode",{parentName:"a"},"output.libraryTarget"))," \u4e3a ",Object(r.b)("inlineCode",{parentName:"p"},'"system"'),"\uff0c\u6216\u8bbe\u7f6erollup\u7684 ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://rollupjs.org/guide/en/#outputformat"}),Object(r.b)("inlineCode",{parentName:"a"},"format"))," \u4e3a",Object(r.b)("inlineCode",{parentName:"p"},'"system"'),"\u3002"),Object(r.b)("p",null,"\u50cfReact, Vue, and Angular\u8fd9\u6837\u7684\u5171\u4eab\u4f9d\u8d56\uff0c\u5b83\u4eec\u6ca1\u6709\u53d1\u5e03System.register versions\u7684\u5305\uff0c\u7136\u800c\u6211\u4eec\u53ef\u4ee5\u627e\u5230",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/esm-bundle"}),"the esm-bundle project")," (",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://medium.com/@joeldenning/an-esm-bundle-for-any-npm-package-5f850db0e04d"}),"blog post"),")\u3002\u6216\u8005\uff0cSystemJS\u80fd\u591f\u901a\u8fc7","[global loading]","(",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/systemjs/systemjs"}),"https://github.com/systemjs/systemjs")," -loader)\u6216",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/systemjs/systemjs#extras"}),"AMD\u548cnamedexports extras"),"\u52a0\u8f7d\u5b83\u4eec\u3002"),Object(r.b)("p",null,"SystemJS\u4e3a\u5bfc\u5165\u6620\u5c04\u63d0\u4f9bpolyfill\u884c\u4e3a\u7684\u53e6\u4e00\u79cd\u9009\u62e9\u662f",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/guybedford/es-module-shims"}),"es-module-shims"),"\u3002\u8fd9\u5177\u6709\u4f7f\u7528\u771f\u6b63\u672c\u673aES\u6a21\u5757\u7684\u4f18\u52bf\u3002\u7136\u800c\uff0c\u8fd9\u5e76\u4e0d\u662fsingle-spa\u6838\u5fc3\u56e2\u961f\u63a8\u8350\u7684\u7528\u4e8e\u751f\u4ea7\u5e94\u7528\u7a0b\u5e8f\u7684\u65b9\u6cd5\uff0c\u56e0\u4e3a\u5b83\u5728\u6d4f\u89c8\u5668\u89e3\u6790\u548c\u4fee\u6539\u6240\u6709\u5305\u65f6\u8981\u6c42\u7684\u6027\u80fd\u8f83\u4f4e\u3002"),Object(r.b)("h2",{id:"\u61d2\u52a0\u8f7d"},"\u61d2\u52a0\u8f7d"),Object(r.b)("p",null,"\u6559\u7a0b\u89c6\u9891: ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.youtube.com/watch?v=-LkvBMpCK-A&list=PLLUD8RtHvsAOhtHnyGx57EYXoaNsxGrTU&index=8"}),"Youtube")," / ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.bilibili.com/video/av83620658/"}),"Bilibili")),Object(r.b)("p",null,"\u5ef6\u8fdf\u52a0\u8f7d\u662f\u53ea\u4e0b\u8f7d\u7528\u6237\u5f53\u524d\u9875\u9762\u6240\u9700\u7684JavaScript\u4ee3\u7801\uff0c\u800c\u4e0d\u662f\u9884\u5148\u4e0b\u8f7d\u6240\u6709JavaScript\u3002\u5b83\u662f\u4e00\u79cd\u901a\u8fc7\u51cf\u5c11\u6700\u521d\u52a0\u8f7d\u9875\u9762\u65f6\u4ea7\u751f\u6709\u610f\u4e49\u5448\u73b0\u7684\u65f6\u95f4\u6765\u63d0\u9ad8\u5e94\u7528\u7a0b\u5e8f\u6027\u80fd\u7684\u6280\u672f\u3002\u5982\u679c\u4f60\u4f7f\u7528",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/configuration#loading-function-or-application"}),"single-spa\u52a0\u8f7d\u51fd\u6570"),"\uff0c\u4f60\u5df2\u7ecf\u4e3a\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u548c\u5305\u88f9\u5185\u7f6e\u4e86\u5ef6\u8fdf\u52a0\u8f7d\u3002\u7531\u4e8e\u5e94\u7528\u7a0b\u5e8f\u662f\u4e00\u4e2a\u201c\u6d4f\u89c8\u5668\u5185\u6a21\u5757\u201d\uff0c\u8fd9\u610f\u5473\u7740\u4f60\u53ea\u5728\u9700\u8981\u65f6\u4e0b\u8f7d\u5bfc\u5165\u6620\u5c04\u4e2d\u7684\u6d4f\u89c8\u5668\u5185\u6a21\u5757\u3002"),Object(r.b)("p",null,"\u901a\u5e38\uff0csingle-spa\u52a0\u8f7d\u51fd\u6570\u63d0\u4f9b\u7684\u57fa\u4e8e\u8def\u7531\u7684\u5ef6\u8fdf\u52a0\u8f7d\u662f\u786e\u4fdd\u826f\u597d\u6027\u80fd\u6240\u9700\u8981\u7684\u5168\u90e8\u3002\u4f46\u662f\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u201c\u4ee3\u7801\u62c6\u5206\u201d\u6765\u4f7f\u7528bundler (webpack\u6216rollup)\u8fdb\u884c\u5ef6\u8fdf\u52a0\u8f7d\u3002\u6709\u5173webpack\u4ee3\u7801\u62c6\u5206\u7684\u6587\u6863\uff0c\u8bf7\u53c2\u89c1",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://webpack.js.org/guides/code-splitting/#dynamic-imports"}),"\u8fd9\u4e9b\u6587\u6863"),"\u3002\u5bf9\u4e8esingle-spa\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684\u4ee3\u7801\u5206\u5272\uff0c\u5efa\u8bae\u4f7f\u7528\u52a8\u6001\u5bfc\u5165(' import() ')\u800c\u4e0d\u662f\u591a\u4e2a\u5165\u53e3\u70b9\u3002\u8981\u4f7f\u4ee3\u7801\u5206\u5272\u6b63\u5e38\u5de5\u4f5c\uff0c\u60a8\u9700\u8981",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://webpack.js.org/guides/public-path/#on-the-fly"}),"\u52a8\u6001\u8bbe\u7f6e\u60a8\u7684\u516c\u5171\u8def\u5f84"),"\u3002\u6709\u4e00\u4e2a\u5de5\u5177\u53ef\u4ee5\u5e2e\u52a9\u60a8\u6b63\u786e\u5730\u8bbe\u7f6e\u4e0esystemjs\u4e00\u8d77\u4f7f\u7528\u7684\u516c\u5171\u8def\u5f84 - ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/joeldenning/systemjs-webpack-interop%E3%80%82"}),"https://github.com/joeldenning/systemjs-webpack-interop\u3002")),Object(r.b)("h2",{id:"\u672c\u5730\u5f00\u53d1"},"\u672c\u5730\u5f00\u53d1"),Object(r.b)("p",null,"\u6559\u7a0b\u89c6\u9891: ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.youtube.com/watch?v=vjjcuIxqIzY&list=PLLUD8RtHvsAOhtHnyGx57EYXoaNsxGrTU&index=4"}),"Youtube")," / ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.bilibili.com/video/av83617789/"}),"Bilibili")),Object(r.b)("p",null,"\u4e0e\u6574\u4f53\u524d\u7aef\u5e94\u7528\u7a0b\u5e8f\u76f8\u6bd4\uff0csingle-spa\u7684\u672c\u5730\u5f00\u53d1\u9f13\u52b1\u53ea\u8fd0\u884c\u60a8\u6b63\u5728\u5f00\u53d1\u7684\u4e00\u4e2amicrofrontend\uff0c\u800c\u4f7f\u7528\u5176\u4ed6\u6240\u6709microfrontend\u7684\u90e8\u7f72\u7248\u672c\u3002\u8fd9\u4e00\u70b9\u5f88\u91cd\u8981\uff0c\u56e0\u4e3a\u6bcf\u6b21\u60a8\u60f3\u8981\u505a\u4efb\u4f55\u4e8b\u60c5\u65f6\u8fd0\u884c\u6bcf\u4e2asingle-spa microfrontend\u90fd\u662f\u975e\u5e38\u7b28\u62d9\u548c\u9ebb\u70e6\u7684\u3002"),Object(r.b)("p",null,"\u4e3a\u4e86\u4e00\u6b21\u53ea\u5b8c\u6210\u4e00\u4e2a\u5fae\u524d\u7aef\u7684\u672c\u5730\u5f00\u53d1\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u5bfc\u5165\u6620\u5c04\u4e2d\u5b9a\u5236\u8be5\u5fae\u524d\u7aef\u7684URL\u3002\u4f8b\u5982\uff0c\u5982\u4e0b\u7684import map \u8bbe\u7f6e\u4e86",Object(r.b)("inlineCode",{parentName:"p"},"navbar"),"\u5e94\u7528\u672c\u5730\u5f00\u53d1\uff0c\u56e0\u4e3a\u5b83\u662f\u552f\u4e00\u6307\u5411\u672c\u5730web\u670d\u52a1\u5668\u7684\u5e94\u7528\uff0c\u800c",Object(r.b)("inlineCode",{parentName:"p"},"planets")," \u548c ",Object(r.b)("inlineCode",{parentName:"p"},"things"),"\u90fd\u6307\u5411\u5df2\u90e8\u7f72\u7684\u5e94\u7528\u7248\u672c\u3002"),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),'{\n  "imports": {\n    "@react-mf/navbar": "https://localhost:8080/react-mf-navbar.js",\n    "@react-mf/planets": "https://react.microfrontends.app/planets/2717466e748e53143474beb6baa38e3e5320edd7/react-mf-planets.js",\n    "@react-mf/things": "https://react.microfrontends.app/things/7f209a1ed9ac9690835c57a3a8eb59c17114bb1d/react-mf-things.js"\n  }\n}\n')),Object(r.b)("p",null,"\u6709\u4e00\u4e2a\u540d\u4e3a",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/joeldenning/import-map-overrides"}),"import-map-overrides"),"\u7684\u5de5\u5177\u53ef\u4ee5\u901a\u8fc7\u6d4f\u89c8\u5668\u5185\u7684UI\u5b9a\u5236\u5bfc\u5165\u5730\u56fe\u3002\u8be5\u5de5\u5177\u5c06\u81ea\u52a8\u5141\u8bb8\u60a8\u5728\u672c\u5730\u4e3b\u673a\u548c\u90e8\u7f72\u7248\u672c\u4e4b\u95f4\u5207\u6362\u4e00\u4e2a\u6216\u591a\u4e2a\u5fae\u524d\u7aef\u3002"),Object(r.b)("p",null,"\u6b64\u5916\uff0c\u60a8\u8fd8\u53ef\u4ee5\u9009\u62e9\u5728\u672c\u5730\u8fd0\u884csingle-spa\u57fa\u7840\u914d\u7f6e\uff0c\u6216\u8005\u4f7f\u7528\u5728\u5df2\u90e8\u7f72\u73af\u5883\u4e0a\u8fd0\u884c\u7684single-spa\u914d\u7f6e\u3002single-spa\u6838\u5fc3\u56e2\u961f\u53d1\u73b0\u5728\u90e8\u7f72\u7684\u73af\u5883(\u53ef\u80fd\u662f\u5728\u60a8\u7684\u7ec4\u7ec7\u4e2d\u8fd0\u884c\u7684\u201c\u96c6\u6210\u201d\u3001\u201c\u5f00\u53d1\u201d\u6216\u201c\u6682\u5b58\u201d\u73af\u5883)\u4e0a\u5f00\u53d1\u662f\u6700\u5bb9\u6613\u7684\uff0c\u56e0\u6b64\u60a8\u4e0d\u5fc5\u7ecf\u5e38\u8fd0\u884csignle-spa\u57fa\u7840\u914d\u7f6e\u3002"),Object(r.b)("h2",{id:"\u6784\u5efa\u5de5\u5177-webpack--rollup"},"\u6784\u5efa\u5de5\u5177 (Webpack / Rollup)"),Object(r.b)("p",null,"\u6559\u7a0b\u89c6\u9891: ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.youtube.com/watch?v=I6COIg-2lyM&list=PLLUD8RtHvsAOhtHnyGx57EYXoaNsxGrTU&index=9"}),"Youtube")," / ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.bilibili.com/video/av84104639/"}),"Bilibili")),Object(r.b)("p",null,"\u5f3a\u70c8\u5efa\u8bae\u4f7f\u7528bundler\uff0c\u5982webpack\u3001rollup\u3001parceljs\u3001pikapack\u7b49\u3002Webpack\u662f\u5c06\u8bb8\u591aJavaScript\u6e90\u6587\u4ef6\u7f16\u8bd1\u6210\u4e00\u4e2a\u6216\u591a\u4e2a\u4ea7\u54c1JavaScript\u5305\u7684\u884c\u4e1a\u6807\u51c6\u3002"),Object(r.b)("p",null,"\u4e0b\u9762\u662f\u4e00\u4e9b\u914d\u7f6e\u60a8\u7684bundler\u4f7f\u5176\u53ef\u88abSystemJS\u548csingle-spa\u4f7f\u7528\u7684\u6280\u5de7\u3002\u6ce8\u610f\uff0c\u5982\u679c\u4f60\u4f7f\u7528",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/create-single-spa"}),"create-single-spa"),"\uff0c\u8fd9\u4e9b\u90fd\u662f\u4e3a\u4f60\u8bbe\u7f6e\u7684\u3002\u6211\u4eec\u628a\u8fd9\u4e9b\u6307\u793a\u7559\u5728\u8fd9\u91cc\uff0c\u4e0d\u662f\u4e3a\u4e86\u8ba9\u4f60\u5728webpack\u914d\u7f6e\u65b9\u9762\u4e0d\u77e5\u6240\u63aa\uff0c\u800c\u662f\u4e3a\u4e86\u5e2e\u52a9\u4f60\uff0c\u5982\u679c\u4f60\u9009\u62e9\u4e0d\u4f7f\u7528creite-single-spa\u7684\u8bdd\u3002"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"\u5c06\u8f93\u51fa\u76ee\u6807\u8bbe\u7f6e\u4e3a\u201csystem\u201d\u3002\u5728webpack\u4e2d\uff0c\u8fd9\u662f\u901a\u8fc7",Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"https://webpack.js.org/configuration/output/#outputlibrarytarget"}),Object(r.b)("inlineCode",{parentName:"a"},"output.libraryTarget")),"\u5b8c\u6210\u7684\u3002"),Object(r.b)("li",{parentName:"ol"},"\u4f7f\u7528\u4e00\u4e2a\u5355\u72ec\u7684",Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"https://webpack.js.org/concepts/entry-points/#root"}),"\u5165\u53e3\u70b9"),"\u548c",Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"https://webpack.js.org/guides/code-splitting/#dynamic-imports"}),"dynamic imports"),"\u6765\u5b8c\u6210\u4efb\u4f55\u4f60\u60f3\u5b8c\u6210\u7684\u4ee3\u7801\u5206\u5272\u3002\u8fd9\u5f88\u7b26\u5408single-spa\u6838\u5fc3\u56e2\u961f\u9f13\u52b1\u7684\u201c\u4e00\u4e2a\u6346\u7ed1\u9879\u76ee\u662f\u4e00\u4e2a\u8fd0\u884c\u65f6\u6a21\u5757\u201d\u7406\u5ff5\u3002"),Object(r.b)("li",{parentName:"ol"},"\u4e0d\u8981\u4f7f\u7528webpack\u7684",Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"https://webpack.js.org/configuration/optimization/#root"}),Object(r.b)("inlineCode",{parentName:"a"},"optimization")),"\u914d\u7f6e\u9009\u9879\uff0c\u56e0\u4e3a\u5b83\u4eec\u4f1a\u4f7f\u8f93\u51fa\u7684JavaScript\u6587\u4ef6\u96be\u4ee5\u4f5c\u4e3a\u4e00\u4e2a\u5355\u4e00\u7684\u6d4f\u89c8\u5668\u5185JavaScript\u6a21\u5757\u52a0\u8f7d\u3002\u8fd9\u6837\u505a\u5e76\u4e0d\u4f1a\u964d\u4f4ebundle\u7684\u4f18\u5316\u7a0b\u5ea6 - \u52a8\u6001\u5bfc\u5165\u662f\u5b9e\u73b0\u4f18\u5316bundle\u7684\u53ef\u884c\u7b56\u7565\u3002"),Object(r.b)("li",{parentName:"ol"},"Follow ",Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/systemjs/systemjs#compatibility-with-webpack"}),"the systemjs docs for webpack"),"."),Object(r.b)("li",{parentName:"ol"},"\u4f7f\u7528 ",Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/joeldenning/systemjs-webpack-interop"}),"systemjs-webpack-interop")," \u6765\u521b\u5efa\u6216\u9a8c\u8bc1\u4f60\u7684webpack\u914d\u7f6e\u3002"),Object(r.b)("li",{parentName:"ol"},"\u4f7f\u7528 ",Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/joeldenning/systemjs-webpack-interop"}),"systemjs-webpack-interop")," \u6765 ",Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"https://webpack.js.org/guides/public-path/#on-the-fly"}),"\u8fd0\u884c\u65f6\u8bbe\u7f6ewebpack public path"),"."),Object(r.b)("li",{parentName:"ol"},"\u4e0d\u8981\u8bbe\u7f6e ",Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"https://webpack.js.org/configuration/output/#outputlibrary"}),Object(r.b)("inlineCode",{parentName:"a"},"output.library")),"\u3002 SystemJS \u4e0d\u9700\u8981\u4e00\u4e2a\u540d\u79f0\uff0c\u4e8b\u5b9e\u4e0a\u5728\u6ca1\u6709\u66f4\u591a\u914d\u7f6e\u7684\u60c5\u51b5\u4e0b\u4e5f\u4e0d\u652f\u6301\u5177\u540d\u6a21\u5757\u3002"),Object(r.b)("li",{parentName:"ol"},"\u8003\u8651\u5173\u95ed ",Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"https://webpack.js.org/configuration/output/#outputfilename"}),"webpack hashing")," \u4e3a\u5165\u53e3\u6587\u4ef6\u548cfbundles\u3002\u5728\u90e8\u7f72microfrontend\u671f\u95f4\u901a\u8fc7CI\u73af\u5883\u53d8\u91cf\u6dfb\u52a0commit hash\u901a\u5e38\u66f4\u5bb9\u6613\u3002"),Object(r.b)("li",{parentName:"ol"},"\u8bbe\u7f6ewebpack-dev-server\u4e0d\u8981\u68c0\u67e5hosts (",Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"https://webpack.js.org/configuration/dev-server/#devserverdisablehostcheck"}),"docs"),")."),Object(r.b)("li",{parentName:"ol"},"\u901a\u8fc7\u8bbe\u7f6e ",Object(r.b)("inlineCode",{parentName:"li"},"{headers: {'Access-Control-Allow-Origin': '*'}}"),". (",Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"https://stackoverflow.com/questions/31602697/webpack-dev-server-cors-issue"}),"docs"),") \u4e3awebpack-dev-server \u5f00\u542fCORS\u3002"),Object(r.b)("li",{parentName:"ol"},"\u5982\u679c\u5f00\u53d1\u9700\u8981HTTPS ",Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"https://webpack.js.org/configuration/dev-server/#devserverhttps"}),"configure webpack-dev-server for HTTPS"),". \u4e5f\u53ef\u4f7f\u7528 ",Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"https://stackoverflow.com/questions/7580508/getting-chrome-to-accept-self-signed-localhost-certificate"}),"trusting SSL certificates from localhost"),"."),Object(r.b)("li",{parentName:"ol"},"\u786e\u4fdd",Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"https://webpack.js.org/configuration/externals/#root"}),"webpack externals")," \u662f\u914d\u7f6e\u6b63\u786e\u5e76\u5171\u4eab\u7684\u8fd0\u884c\u65f6\u6a21\u5757\u3002"),Object(r.b)("li",{parentName:"ol"},"\u8bbe\u7f6e ",Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"https://webpack.js.org/configuration/output/#outputjsonpfunction"}),"output.jsonpFunction")," \u4e3a\u4e00\u4e2a\u672c\u9879\u76ee\u552f\u4e00\u7684\u5b57\u7b26\u4e32\u3002\u56e0\u4e3a\u4f60\u4f1a\u6709\u5f88\u591awebpack bundles\u4f1a\u540c\u65f6\u5728\u540c\u4e00\u4e2a\u6d4f\u89c8\u5668tab\u91cc\u8fd0\u884c\uff0c jsonpFunction\u7684\u78b0\u649e\u53ef\u80fd\u4f1a\u5bfc\u81f4webpack\u6a21\u5757\u5728bundle\u4e4b\u95f4\u6df7\u5408\u3002"),Object(r.b)("li",{parentName:"ol"},"\u8bbe\u7f6e ",Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"https://webpack.js.org/configuration/dev-server/#devserversockport"}),"sockPort"),", ",Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"https://webpack.js.org/configuration/dev-server/#devserversockpath"}),"sockPath"),", \u548c ",Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"https://webpack.js.org/configuration/dev-server/#devserversockhost"}),"sockHost")," \u5728\u4f60\u7684 ",Object(r.b)("inlineCode",{parentName:"li"},"devServer")," \u8bbe\u7f6e\u4e2d\u3002")),Object(r.b)("p",null,"\u66f4\u591a\u5173\u4e8ewebpack\u4ee3\u7801\u62c6\u5206\u7684\u4fe1\u606f\u8bf7\u89c1",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/faq#code-splits"}),"the code splits FAQ"),"."),Object(r.b)("h2",{id:"utility-modules-styleguide-api-etc"},"Utility modules (styleguide, API, etc)"),Object(r.b)("p",null,'A "utility module" is an in-browser JavaScript module that is not a single-spa application or parcel. In other words, it\'s only purpose is to export functionality for other microfrontends to import.'),Object(r.b)("p",null,"Common examples of utility modules include styleguides, authentication helpers, and API helpers. These modules do not need to be registered with single-spa, but are important for maintaining consistency between several single-spa applications and parcels."),Object(r.b)("p",null,"Example code in a utility module:"),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-js"}),'// In a repo called "api", you may export functions from the repo\'s entry file.\n// These functions will be available to single-spa application, parcels, and other in-browser modules\n// via an import statement.\n\nexport function authenticatedFetch(url, init) {\n  return fetch(url, init).then(r => {\n    // Maybe do some auth stuff here\n    return r.json()\n  })\n}\n')),Object(r.b)("p",null,"Example code in a single-spa application that is using the utility module:"),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-js"}),"// Inside of a single-spa application, you can import the functions from the 'api' repo\nimport React from 'react'\nimport { authenticatedFetch } from '@org-name/api';\n\nexport function Foo(props) {\n  React.useEffect(() => {\n    const abortController = new AbortController()\n    authenticatedFetch(`/api/clients/${props.clientId}`, {signal: abortController.signal})\n    .then(client => {\n      console.log(client)\n    })\n\n    return () => {\n      abortController.abort()\n    }\n  }, [props.clientId])\n\n  return null\n}\n")),Object(r.b)("p",null,"To make utility modules work, you must ensure that your webpack externals and import map are properly configured. An example of a working styleguide may be found at ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/vue-microfrontends/styleguide"}),"https://github.com/vue-microfrontends/styleguide"),"."),Object(r.b)("h2",{id:"shared-dependencies"},"Shared dependencies"),Object(r.b)("p",null,"For performance, it is crucial that your web app loads large JavaScript libraries only once. Your framework of choice (React, Vue, Angular, etc) should only be loaded on the page a single time."),Object(r.b)("p",null,"It is not advisable to make everything a shared dependency, because shared dependencies must be upgraded at once for every microfrontend that uses them. For small libraries, it is likely acceptable to duplicate them in each microfrontend that uses them. For example, react-router is likely small enough to duplicate, which is nice when you want to upgrade your routing one microfrontend at a time. However, for large libraries like react, momentjs, rxjs, etc, you may consider making them shared dependencies."),Object(r.b)("p",null,"There are two approaches to sharing dependencies:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"#import-maps"}),"In-browser modules with import maps")),Object(r.b)("li",{parentName:"ol"},Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"#module-federation"}),"Build-time modules with module federation"))),Object(r.b)("p",null,"You may use either one, or both. We currently recommend only using import maps, although we have no objection to module federation."),Object(r.b)("h3",{id:"comparison-of-approaches"},"Comparison of approaches"),Object(r.b)("table",null,Object(r.b)("thead",{parentName:"table"},Object(r.b)("tr",{parentName:"thead"},Object(r.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Approach"),Object(r.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Share dependencies"),Object(r.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Bundler requirements"),Object(r.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Managing dependencies"))),Object(r.b)("tbody",{parentName:"table"},Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Import Maps"),Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Fully supported"),Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Any bundler"),Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(r.b)("a",Object(n.a)({parentName:"td"},{href:"https://github.com/polyglot-microfrontends/shared-dependencies/blob/master/importmap.json"}),"shared dependecies repo"))),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Module Federation"),Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Fully supported"),Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Only webpack@>=5"),Object(r.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(r.b)("a",Object(n.a)({parentName:"td"},{href:"https://github.com/ScriptedAlchemy/mfe-webpack-demo/blob/f48ff0bd0b7d62b722ea000e5ded73f0d076a0b7/packages/01-host/webpack.config.js#L47"}),"multiple webpack configs"))))),Object(r.b)("h3",{id:"sharing-with-import-maps"},"Sharing with Import Maps"),Object(r.b)("p",null,"To share a dependency between microfrontends with ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"#import-maps"}),"Import Maps"),", you should use ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://webpack.js.org/configuration/externals/#root"}),"webpack externals"),", ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://rollupjs.org/guide/en/#external"}),"rollup externals"),", or similar. Marking libraries as external tells your bundler to not use the version in your node_modules, but rather to expect the library to exist as an in-browser module."),Object(r.b)("p",null,"To make the shared dependencies available as in-browser modules, they must be present in your import map. A good way of managing them is to create a repository called ",Object(r.b)("inlineCode",{parentName:"p"},"shared-dependencies")," that has a partial import map in it. The CI process for that repository updates your deployed import map. Upgrading the shared dependencies can then be achieved by making a pull request to that repository."),Object(r.b)("p",null,"Not all libraries publish their code in a suitable format for SystemJS consumption. In those cases, check ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/esm-bundle"}),"https://github.com/esm-bundle")," for a SystemJS version of those libraries. Alternatively, you may use ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/systemjs/systemjs#extras"}),"SystemJS extras")," to support UMD bundles, which are often available."),Object(r.b)("p",null,"An example of a shared-dependencies repo, along with a functioning CI process for it, can be found at ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/polyglot-microfrontends/shared-dependencies"}),"https://github.com/polyglot-microfrontends/shared-dependencies"),"."),Object(r.b)("h3",{id:"sharing-with-module-federation"},"Sharing with Module Federation"),Object(r.b)("p",null,"At the time of this writing, module federation is new and still changing. Check out ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/joeldenning/mfe-webpack-demo/tree/system"}),"this example repo")," which uses systemjs to load the microfrontends, but module federation to share ",Object(r.b)("inlineCode",{parentName:"p"},"react"),", ",Object(r.b)("inlineCode",{parentName:"p"},"react-dom"),", and ",Object(r.b)("inlineCode",{parentName:"p"},"react-router"),"."),Object(r.b)("h2",{id:"deployment-and-continuous-integration-ci"},"Deployment and Continuous Integration (CI)"),Object(r.b)("p",null,"Tutorial video (Part 1): ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.youtube.com/watch?v=QHunH3MFPZs&list=PLLUD8RtHvsAOhtHnyGx57EYXoaNsxGrTU&index=5"}),"Youtube")," / ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.bilibili.com/video/av84100303/"}),"Bilibili")),Object(r.b)("p",null,"Tutorial video (Part 2): ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.youtube.com/watch?v=nC7rpDXa4B8&list=PLLUD8RtHvsAOhtHnyGx57EYXoaNsxGrTU&index=6"}),"Youtube")," / ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.bilibili.com/video/av84099642/"}),"Bilibili")),Object(r.b)("p",null,Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/single-spa/import-map-deployer/tree/master/examples"}),"Example CI configuration files")),Object(r.b)("p",null,"Microfrontends are built and deployed completely independently. This means that the git repository, CI, build, and deployments all occur without going through a centralized repository. For this reason, monorepos are not encouraged for microfrontends since monorepos may only have one CI for all of the packages in the repo."),Object(r.b)("p",null,"There are two steps to deploying a microfrontend."),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"Uploading production JavaScript bundles to a web server / CDN. It is encouraged to use a CDN such as AWS S3 + Cloudfront, Google Cloud Storage, Microsoft Azure Storage, Digital Ocean Spaces, etc because of their superior availability, caching, and performance due to edge locations. The JavaScript files that you upload are completely static. It is encouraged to always write new files to the CDN instead of overwriting files."),Object(r.b)("li",{parentName:"ol"},"Updating your import map to point to the newly deployed file.")),Object(r.b)("p",null,"The implementation of Step 1 is dependent on the infrastructure you're using for your CDN. The AWS CLI (",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://docs.aws.amazon.com/cli/latest/reference/s3/"}),Object(r.b)("inlineCode",{parentName:"a"},"aws s3 sync")),"), Google gsutil (",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/single-spa/import-map-deployer/blob/master/examples/ci-for-javascript-repo/gitlab-gcp-storage/.gitlab-ci.yml"}),Object(r.b)("inlineCode",{parentName:"a"},"gsutil cp")),"), etc are easy ways of accomplishing this."),Object(r.b)("p",null,"For the implementation of Step 2, you have a choice:"),Object(r.b)("p",null,"a) Your CI makes a ",Object(r.b)("inlineCode",{parentName:"p"},"curl")," HTTP call to a running instance of ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/single-spa/import-map-deployer"}),"import-map-deployer"),", which updates the import map in a concurrent-safe way.\nb) Your CI runner pulls down the import map, modify it, and reuploads it."),Object(r.b)("p",null,"The advantage of a) is that it is concurrent-safe for multiple, simultaneous deployments. Without a concurrent-safe solution, there might be multiple processes pulling down and reuploading the import map at the same time, which could result in a race condition where one CI process thinks it successfully updated the import map when in reality the other CI process wrote the import map later, having based its changes on a stale version of the import map."),Object(r.b)("p",null,"The advantage of b) is that it doesn't require running the import-map-deployer in your production environment. Ultimately, you should choose whichever option makes sense for your organization."),Object(r.b)("h2",{id:"applications-versus-parcels-versus-utility-modules"},"Applications versus parcels versus utility modules"),Object(r.b)("p",null,"Single-spa has ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/microfrontends-concept#types-of-microfrontends"}),"different categories")," of microfrontends. It is up to you where and how you use each of them. However, the single-spa core team recommends the following:"),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Many route-based single-spa applications, very few single-spa parcels")),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"Prefer splitting microfrontends by route, instead of by components within a route. This means preferring single-spa applications over single-spa parcels whenever possible. The reason for this is that transitions between routes often involve destroying and recreating most UI state, which means your single-spa applications on different routes do not need to ever share UI state."),Object(r.b)("li",{parentName:"ol"},"Move fixed navigation menus into their own single-spa applications. Implement their ",Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"/docs/configuration#activity-function"}),"activity functions")," to be active by default, only unmounting for the login page."),Object(r.b)("li",{parentName:"ol"},"Create utility modules for your core component library / styleguide, for shared authentication / authorization code, and for global error handling."),Object(r.b)("li",{parentName:"ol"},"If you are only using one framework, prefer framework components (i.e. React, Vue, and Angular components) over single-spa parcels. This is because framework components interop easier with each other than when there is an intermediate layer of single-spa parcels. You can import components between single-spa applications You should only create a single-spa parcel if you need it to work with multiple frameworks.")),Object(r.b)("h2",{id:"inter-app-communication"},"Inter-app communication"),Object(r.b)("p",null,Object(r.b)("em",{parentName:"p"},"A good architecture is one in which microfrontends are decoupled and do not need to frequently communicate. Following the guidelines above about applications versus parcels helps you keep your microfrontends decoupled. Route-based single-spa applications inherently require less inter-app communication.")),Object(r.b)("p",null,"There are three things that microfrontends might need to share / communicate:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"Functions, components, logic, and environment variables."),Object(r.b)("li",{parentName:"ol"},"API data"),Object(r.b)("li",{parentName:"ol"},"UI state")),Object(r.b)("h3",{id:"functions-components-logic-and-environment-variables"},"Functions, components, logic, and environment variables"),Object(r.b)("p",null,"Example - ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/vue-microfrontends/styleguide/blob/af3eaa70bec7daa74635eb3ec76140fb647b0b14/src/vue-mf-styleguide.js#L5"}),"exporting a shared component")," and ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/vue-microfrontends/rate-dogs/blob/fe3196234b9cbd6d627199b03a96e7b5f0285c4b/src/components/rate-dogs.vue#L25"}),"importing a shared component"),"."),Object(r.b)("p",null,"You can import and export functions, components, logic, and environment variables between your microfrontends that are in different git repos and JavaScript bundles:"),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-js"}),"// Inside of a utility module called @org-name/auth\nexport function userHasAccess(permission) {\n  return loggedInUser.permissions.some(p => p === permission);\n}\n")),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-js"}),"import { userHasAccess } from '@org-name/auth'\n\n// Inside of a single-spa application, import and use a util function from a different microfrontend\nconst showLinkToInvoiceFeature = userHasAccess('invoicing');\n")),Object(r.b)("h3",{id:"api-data"},"API Data"),Object(r.b)("p",null,"Example - ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/react-microfrontends/api/blob/c3c336129e920bbc6137f04cce24b718105efed1/src/react-mf-api.js#L3"}),"exporting a ",Object(r.b)("inlineCode",{parentName:"a"},"fetchWithCache")," function")," and ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/react-microfrontends/people/blob/ad18de9b96b52e6975244e6662becfe13e41a2db/src/utils/api.js#L1"}),"importing the function"),"."),Object(r.b)("p",null,"API data often does not need to be shared between microfrontends, since each single-spa application controls different routes and different routes often have different data. However, occasionally you do need to share API data between microfrontends. An in-memory JavaScript cache of API objects is a solution used by several companies to solve this. For React users, this is similar to Data Fetching with Suspense, where the fetching logic for routes is split out from the component code that uses the data."),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-js"}),"// Inside of your api utility module, you can lazily fetch data either when another microfrontend calls your exported\n// functions, or eagerly fetch it when the route changes.\nlet loggedInUserPromise = fetch('...').then(r => {\n  if (r.ok) {\n    return r.json()\n  } else {\n    throw Error(`Error getting user, server responded with HTTP ${r.status}`)\n  }\n})\n\nexport function getLoggedInUser() {\n  return loggedInUserPromise;\n}\n")),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-js"}),"import { getLoggedInUser } from '@org-name/api';\n\n// Inside of app1, you can import something from an \"api\" utility module\ngetLoggedInUser().then(user => {\n  console.log('user', user);\n});\n")),Object(r.b)("h3",{id:"ui-state"},"UI State"),Object(r.b)("p",null,Object(r.b)("em",{parentName:"p"},"If two microfrontends are frequently passing state between each other, consider merging them. The disadvantages of microfrontends are enhanced when your microfrontends are not isolated modules.")),Object(r.b)("p",null,'UI State, such as "is the modal open," "what\'s the current value of that input," etc. largely does not need to be shared between microfrontends. If you find yourself needing constant sharing of UI state, your microfrontends are likely more coupled than they should be. Consider merging them into a single microfrontend.'),Object(r.b)("p",null,"Under the rare circumstances where you do need to share UI state between single-spa applications, an event emitter may be used to do so. Below are a few examples of event emitters that might help you out."),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"Observables / Subjects (rxjs) - one microfrontend emits new values to a stream that can be consumed by any other microfrontend. It exports the observable to all microfrontends from its in-browser module, so that others may import it."),Object(r.b)("li",{parentName:"ol"},"CustomEvents - browsers have a built-in event emitter system that allows you to fire custom events. Check out ",Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Creating_and_triggering_events"}),"this documentation")," for more information. Firing the events with ",Object(r.b)("inlineCode",{parentName:"li"},"window.dispatchEvent")," allows you to subscribe in any other microfrontend with ",Object(r.b)("inlineCode",{parentName:"li"},"window.addEventListener"),"."),Object(r.b)("li",{parentName:"ol"},"Any other pub/sub event emitter system.")),Object(r.b)("h2",{id:"state-management"},"State management"),Object(r.b)("p",null,"The single-spa core team cautions against using redux, mobx, and other global state management libraries. However, if you'd like to use a state management library, we recommend keeping the state management tool specific to a single repository / microfrontend instead of a single store for all of your microfrontends. The reason is that microfrontends are not truly decoupled or framework agnostic if they all must use a global store. You cannot independently deploy a microfrontend if it relies on the global store's state to be a specific shape or have specific actions fired by other microfrontends - to do so you'd have to think really hard about whether your changes to the global store are backwards and forwards compatible with all other microfrontends. Additionally, managing global state during route transitions is hard enough without the complexity of multiple microfrontends contributing to and consuming the global state."),Object(r.b)("p",null,'Instead of a global store, the single-spa core team recommends using local component state for your components, or a store for each of your microfrontends. See the above section "Inter-app communication" for more related information.'))}p.isMDXComponent=!0},308:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"b",(function(){return b}));var n=a(0),o=a.n(n),r=o.a.createContext({}),i=function(e){var t=o.a.useContext(r),a=t;return e&&(a="function"==typeof e?e(t):Object.assign({},t,e)),a},s=function(e){var t=i(e.components);return o.a.createElement(r.Provider,{value:t},e.children)};var c="mdxType",l={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},p=Object(n.forwardRef)((function(e,t){var a=e.components,n=e.mdxType,r=e.originalType,s=e.parentName,c=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&-1===t.indexOf(n)&&(a[n]=e[n]);return a}(e,["components","mdxType","originalType","parentName"]),p=i(a),b=n,m=p[s+"."+b]||p[b]||l[b]||r;return a?o.a.createElement(m,Object.assign({},{ref:t},c,{components:a})):o.a.createElement(m,Object.assign({},{ref:t},c))}));function b(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=a.length,i=new Array(r);i[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:n,i[1]=s;for(var b=2;b<r;b++)i[b]=a[b];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,a)}p.displayName="MDXCreateElement"}}]);